<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to wlingo</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>

<body>
    <div class="container start-container">
        <h1 class="start-h1">wlingo</h1>
        <p class="start-p">
            Choose a topic and start learning!
        </p>

        <form action="/start" method="POST" id="start-form">

            <div class="start-div">
                <label for="topic" class="start-label">
                    Select Vocabulary Set:
                </label>

                <select name="topic" id="topic" class="topic-select" disabled>
                    <option value="" disabled selected>Loading topics...</option>
                </select>

                <div id="error-message" class="start-error"></div>
            </div>

            <button type="submit" id="start-btn" class="start-new-quiz-btn start-btn-lg" disabled>
                Start Quiz ▶️
            </button>
        </form>
    </div>

    <script>
        $(document).ready(function () {
            const $select = $('#topic');
            const $startButton = $('#start-btn');
            const $errorMessage = $('#error-message');

            // Clear loading text
            $select.empty();

            // Add Arithmetic option first
            $select.append(
                $('<option>', {
                    value: '__arithmetic__',
                    text: 'Arithmetic Quiz'
                })
            );

            $.get('/api/topics')
                .done(function (topics) {
                    if (topics.length > 0) {
                        $.each(topics, function (index, topic) {
                            const optionText = `${topic.name} (${topic.count} words)`;
                            $select.append(
                                $('<option>', {
                                    value: topic.id,
                                    text: optionText
                                })
                            );
                        });
                    } else {
                        $errorMessage.text('No vocabulary files found.').show();
                    }
                })
                .fail(function () {
                    $errorMessage.text('Failed to connect to server to load vocabulary.').show();
                })
                .always(function() {
                    // Enable the form elements regardless of API call success
                    $select.prop('disabled', false);
                    $startButton.prop('disabled', false);
                });
        });
    </script>
</body>

</html>